# 白板网站 - 开发指南

## 项目结构

```
whiteboard-for-agents/
├── server/                 # 后端服务
│   ├── index.js           # 服务器入口文件
│   └── package.json       # 服务器依赖
├── client/                # 前端应用
│   ├── src/
│   │   ├── components/    # React 组件
│   │   │   ├── MarkdownEditor.tsx
│   │   │   ├── Toolbar.tsx
│   │   │   └── StatusBar.tsx
│   │   ├── App.tsx        # 主应用组件
│   │   ├── main.tsx       # 应用入口
│   │   └── index.css      # 全局样式
│   ├── index.html         # HTML 模板
│   ├── package.json       # 前端依赖
│   ├── vite.config.ts     # Vite 配置
│   ├── tsconfig.json      # TypeScript 配置
│   └── tailwind.config.js # Tailwind CSS 配置
├── package.json           # 根项目配置
├── README.md              # 项目说明
├── 项目需求文档.md        # 需求文档
└── 部署指南.md            # 部署说明
```

## 技术栈详解

### 后端技术栈
- **Node.js**: JavaScript 运行时环境
- **Express**: Web 应用框架
- **Socket.IO**: WebSocket 库，实现实时通信
- **CORS**: 跨域资源共享中间件
- **UUID**: 生成唯一标识符

### 前端技术栈
- **React 18**: 用户界面库
- **TypeScript**: 类型安全的 JavaScript
- **Vite**: 快速构建工具
- **Tailwind CSS**: 实用优先的 CSS 框架
- **Lucide React**: 图标库

## 核心功能实现

### 1. 实时协作系统

#### WebSocket 连接管理
```typescript
// 客户端连接
const socket = io('http://localhost:3001');

// 服务器端处理
io.on('connection', (socket) => {
  // 处理用户连接
});
```

#### 内容同步机制
```typescript
// 发送内容更新
socket.emit('content-update', {
  whiteboardId: 'main-board',
  content: newContent
});

// 接收内容更新
socket.on('content-updated', (data) => {
  setContent(data.content);
});
```

### 2. 纯文本编辑器

#### 编辑器组件
```typescript
const TextEditor: React.FC<Props> = ({ content, onContentChange }) => {
  return (
    <div className="flex-1 flex flex-col">
      <div className="editor-container">
        <textarea
          className="editor-textarea"
          value={content}
          onChange={handleEditorChange}
          placeholder="在这里输入文本内容..."
        />
      </div>
    </div>
  );
};
```

### 3. 状态管理

#### 应用状态
```typescript
interface AppState {
  socket: Socket | null;
  whiteboardData: WhiteboardData | null;
  isConnected: boolean;
  userCount: number;
  isLoading: boolean;
}
```

#### 状态更新
```typescript
const [whiteboardData, setWhiteboardData] = useState<WhiteboardData | null>(null);

const handleContentChange = (content: string) => {
  // 本地状态更新
  setWhiteboardData(prev => prev ? { ...prev, content } : null);
  
  // 发送到服务器
  socket?.emit('content-update', { whiteboardId, content });
};
```

## 开发工作流

### 1. 本地开发
```bash
# 启动开发服务器
npm run dev

# 前端开发服务器: http://localhost:3000
# 后端 API 服务器: http://localhost:3001
```

### 2. 代码规范
```bash
# 运行 ESLint
cd client
npm run lint

# 类型检查
npx tsc --noEmit
```

### 3. 构建和测试
```bash
# 构建前端
cd client
npm run build

# 预览构建结果
npm run preview
```

## 组件设计

### 1. 组件层次结构
```
App
├── Toolbar
├── TextEditor
└── StatusBar
```

### 2. 组件职责
- **App**: 主应用组件，管理全局状态和 WebSocket 连接
- **Toolbar**: 工具栏，提供保存、下载、分享等功能
- **TextEditor**: 纯文本编辑器组件
- **StatusBar**: 状态栏，显示在线人数、连接状态等信息

### 3. 组件通信
- 通过 props 传递数据
- 通过回调函数传递事件
- 通过 WebSocket 实现跨组件通信

## 样式系统

### Tailwind CSS 配置
```javascript
module.exports = {
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {
      fontFamily: {
        'mono': ['JetBrains Mono', 'Monaco', 'Consolas', 'monospace'],
      },
    },
  },
  plugins: [],
}
```

### 自定义样式
```css
@layer components {
  .editor-container {
    @apply h-full flex flex-col;
  }
  
  .editor-textarea {
    @apply w-full h-full p-4 border-0 resize-none focus:outline-none;
  }
}
```

## 性能优化

### 1. 前端优化
- 使用 React.memo 避免不必要的重渲染
- 使用 useCallback 优化回调函数
- 使用 useMemo 优化计算密集型操作

### 2. 后端优化
- 使用内存存储提高响应速度
- 实现内容防抖，避免频繁更新
- 使用连接池管理 WebSocket 连接

### 3. 网络优化
- 实现内容压缩
- 使用 CDN 加速静态资源
- 实现离线缓存

## 测试策略

### 1. 单元测试
```bash
# 安装测试依赖
npm install --save-dev jest @testing-library/react

# 运行测试
npm test
```

### 2. 集成测试
```bash
# 测试 WebSocket 连接
# 测试内容同步
# 测试用户交互
```

### 3. 端到端测试
```bash
# 使用 Cypress 或 Playwright
# 测试完整用户流程
```

## 部署和监控

### 1. 环境配置
```bash
# 开发环境
NODE_ENV=development
PORT=3001

# 生产环境
NODE_ENV=production
PORT=3001
```

### 2. 日志管理
```javascript
// 服务器日志
console.log('用户连接:', socket.id);
console.log('白板内容已更新');

// 错误日志
console.error('Socket 错误:', error);
```

### 3. 监控指标
- 在线用户数量
- 连接状态
- 内容更新频率
- 错误率

## 扩展开发

### 1. 添加新功能
- 创建新的 React 组件
- 添加相应的 WebSocket 事件
- 更新状态管理逻辑

### 2. 自定义主题
- 修改 Tailwind CSS 配置
- 添加自定义 CSS 类
- 实现主题切换功能

### 3. 插件系统
- 定义插件接口
- 实现插件加载机制
- 提供插件开发文档
