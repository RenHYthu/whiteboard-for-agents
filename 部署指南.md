# 白板网站 - 部署指南

## 快速开始

### 1. 安装依赖
```bash
# 安装所有依赖（根目录、服务器、客户端）
npm run install:all
```

### 2. 开发模式
```bash
# 同时启动前端和后端开发服务器
npm run dev
```

### 3. 访问应用
打开浏览器访问: http://localhost:3000

## 详细部署步骤

### 环境要求
- Node.js 16+ 
- npm 8+

### 手动安装步骤

#### 1. 安装根目录依赖
```bash
npm install
```

#### 2. 安装服务器依赖
```bash
cd server
npm install
```

#### 3. 安装客户端依赖
```bash
cd ../client
npm install
```

#### 4. 构建客户端
```bash
npm run build
```

#### 5. 启动服务器
```bash
cd ../server
npm start
```

## 生产环境部署

### 使用 PM2 部署
```bash
# 安装 PM2
npm install -g pm2

# 启动应用
pm2 start server/index.js --name whiteboard-server

# 查看状态
pm2 status

# 查看日志
pm2 logs whiteboard-server
```

### 使用 Docker 部署
```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

# 复制 package.json
COPY package*.json ./
COPY server/package*.json ./server/
COPY client/package*.json ./client/

# 安装依赖
RUN npm run install:all

# 构建客户端
RUN cd client && npm run build

# 复制源代码
COPY . .

# 暴露端口
EXPOSE 3001

# 启动应用
CMD ["npm", "start"]
```

```bash
# 构建镜像
docker build -t whiteboard-app .

# 运行容器
docker run -p 3001:3001 whiteboard-app
```

### Nginx 配置
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## 环境变量配置

### 服务器环境变量
```bash
# .env
PORT=3001
NODE_ENV=production
```

### 客户端环境变量
```bash
# .env
VITE_API_URL=http://localhost:3001
```

## 监控和维护

### 日志管理
```bash
# 查看服务器日志
pm2 logs whiteboard-server

# 查看错误日志
pm2 logs whiteboard-server --err

# 清空日志
pm2 flush
```

### 性能监控
```bash
# 查看进程信息
pm2 monit

# 重启应用
pm2 restart whiteboard-server

# 停止应用
pm2 stop whiteboard-server
```

## 故障排除

### 常见问题

#### 1. 端口被占用
```bash
# 查看端口占用
lsof -i :3001

# 杀死进程
kill -9 <PID>
```

#### 2. 依赖安装失败
```bash
# 清除缓存
npm cache clean --force

# 删除 node_modules 重新安装
rm -rf node_modules
npm install
```

#### 3. WebSocket 连接失败
- 检查防火墙设置
- 确认端口 3001 可访问
- 检查代理配置

#### 4. 构建失败
```bash
# 检查 TypeScript 错误
cd client
npx tsc --noEmit

# 检查 ESLint 错误
npm run lint
```

## 安全建议

1. **生产环境**:
   - 使用 HTTPS
   - 配置防火墙
   - 定期更新依赖

2. **监控**:
   - 设置日志轮转
   - 监控内存使用
   - 设置告警

3. **备份**:
   - 定期备份代码
   - 配置自动部署
   - 设置回滚机制
